<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Docker Container Manager</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 50px auto;
            padding: 20px;
            text-align: center;
        }

        .container {
            background: #f5f5f5;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        button {
            background: #007cba;
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 18px;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px;
        }

        button:hover {
            background: #005a87;
        }

        button:disabled {
            background: #cccccc;
            cursor: not-allowed;
        }

        .status {
            margin-top: 20px;
            padding: 10px;
            border-radius: 5px;
            display: none;
        }

        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .loading {
            color: #856404;
            background: #fff3cd;
            border: 1px solid #ffeaa7;
        }
    </style>
</head>
<body>
<div class="container">
    <h1>üê≥ Docker Container Manager</h1>
    <p>–°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä PostgreSQL —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –ø–æ—Ä—Ç–æ–º</p>

    <button id="createBtn" onclick="createContainer()">
        üöÄ –°–æ–∑–¥–∞—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä PostgreSQL
    </button>

    <div id="status" class="status"></div>

    <div style="margin-top: 20px; font-size: 14px; color: #666;">
        <p>–ë—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å –∏–º–µ–Ω–µ–º <strong>pg_autoport</strong></p>
        <p>–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –æ–±—Ä–∞–∑ <strong>db_pg</strong></p>
        <p>–ü–æ—Ä—Ç –±—É–¥–µ—Ç –≤—ã–±—Ä–∞–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ (54321, 54322, ...)</p>
    </div>
</div>

<script>
    // –ó–∞–º–µ–Ω–∏—Ç–µ —ç—Ç–æ—Ç URL –Ω–∞ –≤–∞—à —Ä–µ–∞–ª—å–Ω—ã–π URL —Å–µ—Ä–≤–µ—Ä–∞
    const SERVER_URL = 'http://89.223.123.126:8080';

    async function createContainer() {
        const button = document.getElementById('createBtn');
        const status = document.getElementById('status');

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
        button.disabled = true;
        button.innerHTML = '‚è≥ –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞...';
        status.style.display = 'block';
        status.className = 'status loading';
        status.innerHTML = '–°–æ–∑–¥–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä PostgreSQL...';

        try {
            const response = await fetch(`${SERVER_URL}/api/docker/containers`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    containerName: 'pg_autoport'
                })
            });

            const data = await response.json();

            if (response.ok) {
                // –£—Å–ø–µ—Ö
                status.className = 'status success';
                status.innerHTML = `
                        <h3>‚úÖ –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω!</h3>
                        <p><strong>–°–æ–æ–±—â–µ–Ω–∏–µ:</strong> ${data.message}</p>
                        <p><small>ID –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –∏ –ø–æ—Ä—Ç —É–∫–∞–∑–∞–Ω—ã –≤ —Å–æ–æ–±—â–µ–Ω–∏–∏ –≤—ã—à–µ</small></p>
                    `;

                // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–Ω–æ–ø–∫—É –≤ –∏—Å—Ö–æ–¥–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
                setTimeout(() => {
                    button.disabled = false;
                    button.innerHTML = 'üöÄ –°–æ–∑–¥–∞—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä PostgreSQL';
                }, 3000);

            } else {
                // –û—à–∏–±–∫–∞
                throw new Error(data.details || data.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞');
            }

        } catch (error) {
            // –û—à–∏–±–∫–∞ —Å–µ—Ç–∏ –∏–ª–∏ —Å–µ—Ä–≤–µ—Ä–∞
            status.className = 'status error';
            status.innerHTML = `
                    <h3>‚ùå –û—à–∏–±–∫–∞!</h3>
                    <p><strong>–ü—Ä–∏—á–∏–Ω–∞:</strong> ${error.message}</p>
                    <p><small>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –∏ –¥–æ—Å—Ç—É–ø–µ–Ω</small></p>
                `;

            // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–Ω–æ–ø–∫—É
            button.disabled = false;
            button.innerHTML = 'üöÄ –°–æ–∑–¥–∞—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä PostgreSQL';
        }
    }

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    window.addEventListener('load', async () => {
        try {
            const response = await fetch(`${SERVER_URL}/api/docker/containers`);
            if (!response.ok) {
                throw new Error('–°–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω');
            }
        } catch (error) {
            const status = document.getElementById('status');
            status.style.display = 'block';
            status.className = 'status error';
            status.innerHTML = `
                    <h3>‚ö†Ô∏è –í–Ω–∏–º–∞–Ω–∏–µ</h3>
                    <p>–°–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω: ${SERVER_URL}</p>
                    <p><small>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–µ—Ä–≤–µ—Ä–∞</small></p>
                `;
        }
    });
</script>
</body>
</html>